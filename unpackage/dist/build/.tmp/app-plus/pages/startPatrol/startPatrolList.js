(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/startPatrol/startPatrolList"],{"0699":function(t,a,e){"use strict";e.r(a);var o=e("5617"),n=e.n(o);for(var i in o)"default"!==i&&function(t){e.d(a,t,function(){return o[t]})}(i);a["default"]=n.a},"3c99":function(t,a,e){"use strict";var o=e("9a62"),n=e.n(o);n.a},5617:function(t,a,e){"use strict";(function(t,o){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n=u(e("f40e")),i=u(e("d429")),r=e("bb60");function u(t){return t&&t.__esModule?t:{default:t}}var s={mixins:[r.Common],data:function(){return{page:1,source:0,total:0,PatrolList:[],form:{},finish:0,name:t.getStorageSync("userName")}},onLoad:function(a){this.getList(),1==t.getStorageSync("operation").finish&&(this.form=t.getStorageSync("operation"),this.finish=1),this.source=a.source},onShow:function(){},methods:{submit:function(){this.networkEnable()?(i.default.showLoading(),this.submitTrouble()):i.default.showToast("网络不可用")},checkPatrol:function(a){1==this.source&&(this.$api.prePage().PatrolData=a,t.navigateBack())},getList:function(){var a=this,e={tenantId:t.getStorageSync("tenantId"),current:this.page,size:10};n.default.apiGet("/check",e).then(function(t){200==t.code&&(a.total=t.data.total,1==a.page?a.PatrolList=t.data.records:a.PatrolList=a.PatrolList.concat(t.data.records))})},addPatrol:function(a,e){t.navigateTo({url:"/pages/startPatrol/startPatrol"})},refreshList:function(t,a){this.PatrolList.unshift(t),console.log(o(t,a," at pages\\startPatrol\\startPatrolList.vue:119"))},scrolltolower:function(){this.PatrolList.length<this.total&&(this.page++,this.getList())},submitForm:function(){var a=this;n.default.apiPost("/check/add/",a.form).then(function(a){200==a.code?(i.default.hideLoading(),i.default.showToast("提交成功"),t.removeStorageSync("operation"),t.removeStorageSync("xgItems"),t.removeStorageSync("activityId"),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(i.default.hideLoading(),i.default.showToast("提交失败"))})},submitTrouble:function(){var t=this;this.findTrouble(this.form.xgId,null,function(a){console.log(o(a," at pages\\startPatrol\\startPatrolList.vue:150")),a&&a.length>0?a.forEach(function(a){if(a.pictures){var e=[];e=a.pictures.split(","),t.uploadImg(a,e,0,"")}else t.submitHazard(a)}):t.submitForm()},function(){console.log(o("err"," at pages\\startPatrol\\startPatrolList.vue:169")),t.submitForm()})},submitHazard:function(t){var a=this;n.default.apiPost("/hazard/add/",t).then(function(t){200==t.code?(a.uploaded++,a.uploaded==a.total&&a.submitForm()):(i.default.hideLoading(),i.default.showToast("提交失败"))}).catch(function(t){i.default.hideLoading(),i.default.showToast("请检查网络")})},uploadImg:function(a,e,o,r){var u=this;t.uploadFile({url:n.default.baseURL+"/hazard/upload",filePath:e[o],name:"file",header:{Accept:"application/json",Authorization:"Bearer "+t.getStorageSync("Authorization")},success:function(t){var n=JSON.parse(t.data);200==n.code?o<e.length-1?(o++,r+=n.data+",",u.uploadImg(a,e,o,r)):o==e.length-1&&(r+=n.data,a.pictures=r,u.submitHazard(a)):i.default.showToast("图片上传失败")},fail:function(t){i.default.showToast("请检查网络连接")}})}}};a.default=s}).call(this,e("6e42")["default"],e("0de9")["default"])},"870d":function(t,a,e){"use strict";e.r(a);var o=e("f2c0"),n=e("0699");for(var i in n)"default"!==i&&function(t){e.d(a,t,function(){return n[t]})}(i);e("3c99");var r,u=e("f0c5"),s=Object(u["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);a["default"]=s.exports},"88ba":function(t,a,e){"use strict";(function(t){e("d53d"),e("921b");o(e("66fd"));var a=o(e("870d"));function o(t){return t&&t.__esModule?t:{default:t}}t(a.default)}).call(this,e("6e42")["createPage"])},"9a62":function(t,a,e){},f2c0:function(t,a,e){"use strict";var o,n=function(){var t=this,a=t.$createElement;t._self._c},i=[];e.d(a,"b",function(){return n}),e.d(a,"c",function(){return i}),e.d(a,"a",function(){return o})}},[["88ba","common/runtime","common/vendor"]]]);