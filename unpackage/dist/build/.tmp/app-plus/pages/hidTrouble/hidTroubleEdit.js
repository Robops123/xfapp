(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/hidTrouble/hidTroubleEdit"],{"2f67":function(e,t,n){"use strict";n.r(t);var i=n("4792"),a=n("4aee");for(var o in a)"default"!==o&&function(e){n.d(t,e,function(){return a[e]})}(o);n("cf8f");var r,u=n("f0c5"),c=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);t["default"]=c.exports},4792:function(e,t,n){"use strict";var i,a=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"b",function(){return a}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return i})},"4aee":function(e,t,n){"use strict";n.r(t);var i=n("df58"),a=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,function(){return i[e]})}(o);t["default"]=a.a},"55b1":function(e,t,n){},9646:function(e,t,n){"use strict";(function(e){n("d53d"),n("921b");i(n("66fd"));var t=i(n("2f67"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},cf8f:function(e,t,n){"use strict";var i=n("55b1"),a=n.n(i);a.a},df58:function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=c(n("a34a")),o=c(n("f40e")),r=c(n("d429")),u=(n("bb60"),n("2f62"));function c(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,i,a,o,r){try{var u=e[o](r),c=u.value}catch(s){return void n(s)}u.done?t(c):Promise.resolve(c).then(i,a)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function r(e){s(o,i,a,r,u,"next",e)}function u(e){s(o,i,a,r,u,"throw",e)}r(void 0)})}}function d(e,t){return p(e)||h(e,t)||f()}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function h(e,t){var n=[],i=!0,a=!1,o=void 0;try{for(var r,u=e[Symbol.iterator]();!(i=(r=u.next()).done);i=!0)if(n.push(r.value),t&&n.length===t)break}catch(c){a=!0,o=c}finally{try{i||null==u["return"]||u["return"]()}finally{if(a)throw o}}return n}function p(e){if(Array.isArray(e))return e}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){m(e,t,n[t])})}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=[["camera"],["album"],["camera","album"]],b=[["compressed"],["original"],["compressed","original"]],y=function(){return n.e("components/uni-icon/uni-icon").then(n.bind(null,"256b"))},I={components:{uniIcons:y},onLoad:function(t){console.log(e(t," at pages\\hidTrouble\\hidTroubleEdit.vue:102")),this.form.tenantId=i.getStorageSync("tenantId"),this.name=i.getStorageSync("userName"),this.devList=i.getStorageSync("devList"),this.devListAll=i.getStorageSync("devListAll")},data:function(){var e=this.getDate({format:!0});return{uploading:!1,order_no:"",select_item:"",price_type:"common_price",product_name:"",product_image1:"",price:0,date:e,price1:0,price2:0,price3:0,activeIndex:-1,desc:"",index:0,items:[],devList:[],devListAll:[],indexSex:0,indexOld:40,seller:"",seller_id:0,consultant:"",consultant_id:0,consultant_phone:"",buyer:"",buyer_phone:"",buyer_collector:"",remark:"",imageList:[],sourceTypeIndex:2,sizeTypeIndex:2,countIndex:8,count:[1,2,3,4,5,6,7,8,9],name:"",tempImgList:[],uploaded:0,form:{content:"",address:"",pictures:"",createTime:e,devId:"",tenantId:""}}},computed:g({},(0,u.mapState)(["userRole"]),{startDate:function(){return this.getDate("start")},endDate:function(){return this.getDate("end")}}),methods:{checkboxChange:function(e){this.select_item=e.detail.value},submit:function(){r.default.showLoading(),console.log(e(this.form," at pages\\hidTrouble\\hidTroubleEdit.vue:197")),o.default.apiPost("/hazard/add/",this.form).then(function(e){r.default.hideLoading(),200==e.code?(r.default.showToast("提交成功"),i.$emit("troubleListUpdate"),setTimeout(function(){i.navigateBack()},1e3)):r.default.showToast("提交失败")}).catch(function(e){r.default.hideLoading(),r.default.showToast("请检查网络")})},loadCollectTypes:function(){var e=this;this.$api.getCategory("collector_type",0).then(function(t){var n=d(t,2),i=n[0],a=n[1];if(null==i){var o=a.data;for(var r in o)e.items.push({value:r,name:o[r]})}})},bindSexChange:function(e){this.indexSex=e.target.value},bindOldChange:function(e){this.indexOld=e.target.value},wxscan:function(e){var t=this;wx.config(e),wx.ready(function(){wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){var n=e.resultStr,i=n.split(",")[1];if(0==t.buyer_collector.length)t.buyer_collector=i;else{var a=t.buyer_collector.split(",");a.includes(i)||(t.buyer_collector+=","+i)}}})})},switchActive:function(e){var t=this;this.activeIndex=e,setTimeout(function(){t.activeIndex=-1},500);var n={debug:!1,json:!0,apis:"scanQRCode",url:window.location.href.split("#")[0]},i=JSON.parse(sessionStorage.getItem("userToken"));this.$api.getJsSDKConfig(n,i).then(function(e){var n=d(e,2),i=n[0],a=n[1];null==i&&t.wxscan(a.data)})},switchChange:function(e){this.price==this.price1?("representative"==this.userRole?this.price=this.price2:this.price=this.price3,this.price_type="special_price"):(this.price_type="common_price",this.price=this.price1)},sourceTypeChange:function(e){this.sourceTypeIndex=e.target.value},sizeTypeChange:function(e){this.sizeTypeIndex=e.target.value},countChange:function(e){this.countIndex=e.target.value},chooseImage:function(){var e=l(a.default.mark(function e(){var t,n,o=this;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this,9!==this.imageList.length){e.next=7;break}return e.next=4,this.isFullImg();case 4:if(n=e.sent,n){e.next=7;break}return e.abrupt("return");case 7:i.chooseImage({sourceType:v[this.sourceTypeIndex],sizeType:b[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(e){o.imageList=o.imageList.concat(e.tempFilePaths),t.compressImage(e.tempFilePaths)}});case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),upload:function(t){console.log(e(t," at pages\\hidTrouble\\hidTroubleEdit.vue:324"))},compressImage:function(e){var t=this;e.forEach(function(e,n){var i=e.split("/"),a=i[i.length-1];plus.zip.compressImage({src:e,dst:"_doc/"+a,quality:10},function(e){t.uploadImg(e.target)},function(e){r.default.showToast("图片压缩失败")})})},uploadImg:function(e){var t=this.imageList.length,n=this;0!=t&&(n.uploading=!0,i.uploadFile({url:o.default.baseURL+"/hazard/upload",filePath:e,name:"file",header:{Accept:"application/json",Authorization:"Bearer "+i.getStorageSync("Authorization")},success:function(i){var a=JSON.parse(i.data);200==a.code?(n.uploaded++,n.tempImgList.push(e),n.uploaded<t?n.form.pictures+=a.data+",":n.uploaded==t&&(n.imageList=n.tempImgList,n.form.pictures+=a.data,n.uploading=!1)):r.default.showToast("上传失败")},fail:function(e){n.uploading=!1,r.default.showToast("请检查网络连接")}}))},isFullImg:function(){var e=this;return new Promise(function(t){i.showModal({content:"是否清空现有图片？",success:function(n){n.confirm?(e.imageList=[],t(!0)):t(!1)},fail:function(){t(!1)}})})},previewImage:function(e){var t=e.target.dataset.src;i.previewImage({current:t,urls:this.imageList})},getDate:function(e){var t=new Date,n=t.getFullYear(),i=t.getMonth()+1,a=t.getDate(),o=t.getHours(),r=t.getMinutes()+1,u=t.getSeconds();return"start"===e?n-=60:"end"===e&&(n+=2),i=i>9?i:"0"+i,a=a>9?a:"0"+a,o=o>9?o:"0"+o,r=r>9?r:"0"+r,u=u>9?u:"0"+u,"".concat(n,"-").concat(i,"-").concat(a," ").concat(o,":").concat(r,":").concat(u)},bindPickerChange:function(t){var n=this;console.log(e(t," at pages\\hidTrouble\\hidTroubleEdit.vue:433")),this.index=t.target.value,n.form.devId=n.devListAll[t.target.value].devId},bindPickerChange2:function(e){this.date=e.target.value,this.form.createTime=e.target.value}}};t.default=I}).call(this,n("0de9")["default"],n("6e42")["default"])}},[["9646","common/runtime","common/vendor"]]]);