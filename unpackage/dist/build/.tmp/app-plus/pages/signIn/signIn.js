(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/signIn/signIn"],{"1d4a":function(t,e,i){"use strict";i.r(e);var n=i("c6c3"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e["default"]=a.a},"2a07":function(t,e,i){},"2ef0":function(t,e,i){"use strict";i.r(e);var n=i("9ee1"),a=i("1d4a");for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);i("e990");var o,d=i("f0c5"),u=Object(d["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);e["default"]=u.exports},"9ee1":function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.name.substr(-2));t.$mp.data=Object.assign({},{$root:{g0:i}})},s=[];i.d(e,"b",function(){return a}),i.d(e,"c",function(){return s}),i.d(e,"a",function(){return n})},c6c3:function(t,e,i){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i("92f2"),s=i("0632"),o=u(i("f40e")),d=u(i("d429"));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"330e"))},l=function(){return i.e("components/uni-icon/uni-icon").then(i.bind(null,"256b"))},r={components:{uniIcon:l,uniPopup:c},data:function(){return{name:"张龙",bzText:{time:"",address:"",img:"",remarks:""},type:"",signType:"",signDetail:[],r:80,Timer:[{time:"12:00"},{time:"18:00"}],isAm:!1,isPm:!1,amSign:{time:"",address:"",remarks:"",img:""},pmSign:{time:"",address:"",remarks:"",img:""},clickNum:0,is:null,isSign:!1,time:(0,a.formateDate)(new Date,"h:min:s"),date:(0,a.formateDate)(new Date,"Y-M-D"),latitude:"",longitude:"",address:"我的位置",wqInfo:null,allSign:[],signInfo:{mode:"",latitude:"",longitude:"",address:"",time:"",remarks:""},covers:[{id:0,callout:{content:"*****科技有限公司",color:"red",display:"ALWAYS"},latitude:37.788338,longitude:112.557031,iconPath:"../../../static/img/location.png"}],circles:[{latitude:37.788338,longitude:112.557031,radius:80,strokeWidth:1,fillColor:"#7fff0099"}]}},onLoad:function(){this.readSignInfo();var t=(0,s.getSignInfo)();if(void 0!=t){var e=t.main.reverse();this.allSign=e,1==e.length?(0,a.isSameDay)(e[0].nowT)&&(this.isSign=!0,this.isAm=!0,this.allSign=e,this.amSign=e[0]):(e[0]&&(0,a.isSameDay)(e[0].nowT)&&(this.isSign=!0,this.isPm=!0,this.allSign=e,this.pmSign=e[0]),e[1]&&(0,a.isSameDay)(e[1].nowT)&&(this.isSign=!0,this.isAm=!0,this.allSign=e,this.amSign=e[1]))}this.getLocation(),this.getTime()},methods:{togglePopup:function(t){this.type=t},goRule:function(){t.navigateTo({url:"/pages/rule/rule"})},readSignInfo:function(){var e=this,i={tenantId:t.getStorageSync("tenantId")};o.default.apiGet("/attendance/today",i).then(function(t){console.log(n(t," at pages\\signIn\\signIn.vue:245")),200==t.code&&(e.name=t.data.userName,e.date=t.data.attendanceDate,e.signDetail=t.data.datas)})},getAdd:function(){if(!this.isAm||!this.isPm){if(!0===this.is){var e=this.covers[0].callout.content;return this.address=e,void(this.signInfo.address=e)}var i=this,n="https://apis.map.qq.com/ws/geocoder/v1/?location=".concat(i.latitude,",").concat(i.longitude,"&key=").concat(s.key);t.request({url:n,success:function(e){var n=e.data;if(0==n.status){if(null===i.is&&(i.address="请检查位置信息！"),!1===i.is){var a=e.data.result.address+e.data.result.formatted_addresses.recommend;i.address=a,i.signInfo.address=a}i.getSignType()}else t.showToast({title:n.message,icon:"none"})}})}},getData:function(){var e=this,i="";t.request({url:i,success:function(t){var i=t.data;e.covers[0].callout.content=i.name,e.covers[0].latitude=e.circles[0].latitude=i.latitude,e.covers[0].longitude=e.circles[0].longitude=i.longitude,e.r=e.circles.radius=i.r}})},relocation:function(){this.getLocation()},bindDateChange:function(t){this.date=t.target.value},reset:function(){var e=this;t.showModal({title:"重置本地打卡信息",content:"您确定要重置打卡信息吗？点击确定本地打卡信息会被清除！",success:function(t){if(t.confirm)(0,s.delSignInfo)(),e.isSign=!1,e.isAm=!1,e.isPm=!1,e.allSign=[];else if(t.cancel)return}})},showBz:function(t){this.type="middle-list","amSign"==t?(this.bzText.time=this.amSign.time,this.bzText.address=this.amSign.address,this.bzText.remarks=this.amSign.remarks):"pmSign"==t&&(this.bzText.time=this.pmSign.time,this.bzText.address=this.pmSign.address,this.bzText.remarks=this.pmSign.remarks)},getTime:function(){var t=this;setInterval(function(){t.time=(0,a.formateDate)(new Date,"h:min:s")},1e3)},getLocation:function(){var e=this;0!==this.clickNum&&t.showLoading({title:"获取中...",mask:!0}),this.clickNum>=3?t.showToast({title:"请稍后尝试！",icon:"none",mask:!0}):(this.clickNum++,t.getLocation({type:"gcj02",success:function(i){t.hideLoading(),e.latitude=i.latitude,e.longitude=i.longitude,e.covers[1]={id:1,latitude:i.latitude,longitude:i.longitude,iconPath:"../../static/location.png"};var n=(0,a.pointInsideCircle)([e.latitude,e.longitude],[e.circles[0].latitude,e.circles[0].longitude],e.r/1e5);e.is=n,e.signInfo.latitude=i.latitude,e.signInfo.longitude=i.longitude,e.signInfo.mode=n?"正常打卡":"外勤打卡",e.getAdd()},fail:function(i){t.hideLoading(),e.address="请检查位置信息！",t.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})}}))},clickSign:function(e){var i=this;this.is;d.default.showLoading("打卡记录中..."),t.getLocation({type:"gcj02",success:function(u){t.hideLoading(),i.latitude=u.latitude,i.longitude=u.longitude,i.covers[1]={id:1,latitude:u.latitude,longitude:u.longitude,iconPath:"../../static/location.png"};var c=(0,a.pointInsideCircle)([i.latitude,i.longitude],[i.circles[0].latitude,i.circles[0].longitude],i.r/1e5);i.is=c,i.signInfo.latitude=u.latitude,i.signInfo.longitude=u.longitude;var l="https://apis.map.qq.com/ws/geocoder/v1/?location=".concat(i.latitude,",").concat(i.longitude,"&key=").concat(s.key);t.request({url:l,success:function(a){var s=a.data;if(0==s.status)if(null!==i.is){if(!1===i.is){var u=a.data.result.address+a.data.result.formatted_addresses.recommend;i.address=u,i.signInfo.address=u}var c={tenantId:t.getStorageSync("tenantId"),tencentLongitude:i.longitude,tencentLatitude:i.latitude,location:i.address,attendanceType:e};o.default.apiPost("/attendance/add",c).then(function(t){console.log(n(t," at pages\\signIn\\signIn.vue:434")),d.default.hideLoading(),200==t.code?(d.default.showToast("打卡成功"),i.readSignInfo()):d.default.showToast("打卡失败，请重试")}).catch(function(t){d.default.hideLoading(),d.default.showToast("打卡失败，请检查网络")})}else i.address="请检查位置信息！";else t.showToast({title:s.message,icon:"none"})}})},fail:function(e){t.hideLoading(),i.address="请检查位置信息！",t.showToast({title:"请检查位置信息状态！",icon:"none",mask:!0,duration:3e3})}})},getSignType:function(){var e=this,i={tenantId:t.getStorageSync("tenantId"),tencentLongitude:this.longitude,tencentLatitude:this.latitude};console.log(n(i," at pages\\signIn\\signIn.vue:463")),o.default.apiPost("/attendance/type",i).then(function(t){console.log(n(t," at pages\\signIn\\signIn.vue:465")),200==t.code?e.signType=t.data.workType:d.default.showToast("未知错误")}).catch(function(t){d.default.showToast("获取当前状态失败")})},openLocation:function(){var e=this;t.chooseLocation({success:function(t){e.address=t.address,e.signInfo.address=t.address;var i=(0,a.pointInsideCircle)([e.latitude,e.longitude],[e.circles[0].latitude,e.circles[0].longitude],e.r/1e4);e.is=i}})},tab:function(t,e){var i=new Date(t),n=new Date(e);return!(i.getTime()>n.getTime())}}};e.default=r}).call(this,i("6e42")["default"],i("0de9")["default"])},e990:function(t,e,i){"use strict";var n=i("2a07"),a=i.n(n);a.a},ebdc:function(t,e,i){"use strict";(function(t){i("d53d"),i("921b");n(i("66fd"));var e=n(i("2ef0"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])}},[["ebdc","common/runtime","common/vendor"]]]);